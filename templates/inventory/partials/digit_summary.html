{% load static %}
<section class="section-hero">
  <div class="content">
    <div class="w-layout-grid grid-hero">
      <div class="block-hero">
        <h1 class="heading-hero">{{ digit.name }}</h1>
        <p class="paragraph-hero">{{ digit.description }}</p>
      </div>
      <div class="image-journal">
        {% if last_image %}
          <img src="{{ last_image.url }}" alt="Recent image of {{ digit.name }}">
        {% else %}
          <img src="{% static 'main/images/placeholder.svg' %}" alt="Placeholder for no image">
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% if digit.taxonomic_unit %}
  <section class="section">
    <div class="content">
      <div class="block-heading">
        <div class="subtitle">Taxonomy<br></div>
        <h2 class="heading">{{ digit.taxonomic_unit.complete_name }}</h2>
      </div>
      <div class="w-layout-grid grid-features">
        <div class="features">
          <div class="block-heading-features">
            <h5 class="heading-features">Taxonomy 1</h5><img src="{% static 'main/images/lightning.svg' %}" loading="eager" alt="" class="icon-features">
          </div>
          <p class="paragraph-features">Taxonomy 1 Detail</p>
        </div>
        <div class="features">
          <div class="block-heading-features">
            <h5 class="heading-features">Taxonomy 2</h5><img src="{% static 'main/images/lightning.svg' %}" loading="eager" alt="" class="icon-features">
          </div>
          <p class="paragraph-features">Taxonomy 2 Detail</p>
        </div>
        <div class="features">
          <div class="block-heading-features">
            <h5 class="heading-features">Taxonomy 3</h5><img src="{% static 'main/images/lightning.svg' %}" loading="eager" alt="" class="icon-features">
          </div>
          <p class="paragraph-features">Taxonomy 3 Detail</p>
        </div>
      </div>
    </div>
  </section>
{% endif %}

<section class="section">
  <div class="content">
    <div class="w-layout-grid grid-about">
    <div class="about blue">
        <div class="block-icon-about"><img src="{% static 'main/images/water.svg' %}" loading="eager" alt="" class="icon-about"></div>
        <h4 class="heading-about">Watering</h4>
        {% if last_watering_date %}
          <p class="paragraph-about">Last Watered: {{ last_watering_date|date:"Y-m-d" }} ({{ days_since_last_watering }} days ago)</p>
        {% else %}
          <p class="paragraph-about">No watering entries recorded.</p>
        {% endif %}
    </div>
    <div class="about green"> 
        <div class="block-icon-about green"><img src="{% static 'main/images/food.svg' %}" loading="eager" alt="" class="icon-about"></div>
        <h4 class="heading-about green">Fertilizing</h4>
        {% if last_fertilizing_date %}
          <p class="paragraph-about green">Last Fertilized: {{ last_fertilizing_date|date:"Y-m-d" }} ({{ days_since_last_fertilizing }} days ago)</p>
        {% else %}
          <p class="paragraph-about green">No fertilizing entries recorded.</p>
        {% endif %}
    </div>
    <div class="about red">
        <div class="block-icon-about red"><img src="{% static 'main/images/clean.svg' %}" loading="eager" alt="" class="icon-about"></div>
        <h4 class="heading-about red">Cleaning</h4>
        {% if last_cleaning_date %}
          <p class="paragraph-about red">Last Cleaned: {{ last_cleaning_date|date:"Y-m-d" }} ({{ days_since_last_cleaning }} days ago)</p>
        {% else %}
          <p class="paragraph-about red">No cleaning entries recorded.</p>
        {% endif %}
    </div>    
    </div>
  </div>
</section>

<section class="section">
  <div class="content">
    <div class="w-layout-grid grid">
      <div class="accordion-item">
        <!-- Clickable header for toggling the form -->
        <div class="accordion-header" onclick="toggleJournalEntry()">
          <h4 class="heading-accordion">Create Journal Entry</h4>
          <div class="block-icon-accordion" id="toggleIcon">
            <div style="-webkit-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(45deg) skew(0, 0);-moz-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(45deg) skew(0, 0);-ms-transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(45deg) skew(0, 0);transform:translate3d(0, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(45deg) skew(0, 0);background-color:rgba(57,89,255,0.07);border-color:rgba(255,255,255,0.2)" class="block-icon-accordion"><img src="{% static 'main/images/close.svg' %}" loading="eager" alt="" class="icon-accordion"></div>
          </div>
        </div>
        <!-- Container for Journal Form -->
        <div id="journalEntry" style="display: none;">
          <div class="account-form">
            <div class="subtitle blue">Journal Entry<br></div>
            <h2 class="heading-account">Create a New Entry</h2>
              <div class="form-block w-form">
                <form id="journalForm" method="post" class="form" enctype="multipart/form-data">
                  {% csrf_token %}
                  <div>
                    <textarea class="text-field w-input" maxlength="1000" name="content" placeholder="Your entry content" id="content" required=""></textarea>
                      {% if form.content.errors %}
                        <div class="error-message">
                          <small>{{ form.content.errors|striptags }}</small>
                        </div>
                      {% endif %}
                  </div>
                  <div>
                    <input type="file" class="text-field w-input" name="image" id="image">
                      {% if form.image.errors %}
                        <div class="error-message">
                          <small>{{ form.image.errors|striptags }}</small>
                        </div>
                      {% endif %}
                  </div>
                  <div>
                    <label>
                      <input type="checkbox" name="watered" id="watered"> Watered
                    </label>
                    <label>
                      <input type="checkbox" name="fertilized" id="fertilized"> Fertilized
                    </label>
                    <label>
                      <input type="checkbox" name="cleaned" id="cleaned"> Cleaned
                    </label>
                  </div>
                  <input type="submit" value="Submit Entry" data-wait="Please wait..." class="submit-button w-button">
                </form>
              </div>
          </div>
        </div>
      </div>
      <div class="lottie">
        <h3>Journal Entries</h3>
        <table class="table">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Content</th>
              <th scope="col">Date</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in digit.journal_entries.all %}
              <tr>
                <th scope="row">{{ forloop.counter }}</th>
                <td>{{ entry.content }}</td>
                <td>{{ entry.created_at }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4">No journal entries found.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>   
    </div>
  </div>
</section>

<script>
  function toggleJournalEntry() {
    console.log("Toggle function called");
    var journalEntry = document.getElementById('journalEntry');
    var toggleIcon = document.getElementById('toggleIcon');

    if (journalEntry.style.display === 'none' || journalEntry.style.display === '') {
        journalEntry.style.display = 'block';
        toggleIcon.classList.add('rotate-icon');
    } else {
        journalEntry.style.display = 'none';
        toggleIcon.classList.remove('rotate-icon');
    }
  }
</script>