{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Taxon Kingdoms - Digidex</title>
    <meta content="A platform for gardeners to cultivate their curiosity." name="description">
    <meta content="Taxon Kingdoms - Digidex" property="og:title">
    <meta content="A platform for gardeners to cultivate their curiosity." property="og:description">
    <meta content="Taxon Kingdoms - Digidex" property="twitter:title">
    <meta content="A platform for gardeners to cultivate their curiosity." property="twitter:description">
    <meta property="og:type" content="website">
    <meta content="summary_large_image" name="twitter:card">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <link href="{% static 'base/css/normalize.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'base/css/base-styles.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'digidex/css/digidex-styles.css' %}" rel="stylesheet" type="text/css">
  
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.7.4/lottie.min.js" type="text/javascript"></script>

    <!-- Load Fonts -->
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">
      WebFont.load({
        google: {
          families: ["Space Grotesk:regular,500,600,700", "IBM Plex Mono:regular,italic,500,500italic,600,600italic,700,700italic"]
        }
      });
    </script>

    {% load i18n %}
    <script src="{% static 'digidex/js/jquery/jquery.js' %}"></script>
    
    <link href="{% static 'digidex/images/favicon.png' %}" rel="shortcut icon" type="image/x-icon">
    <link href="{% static 'digidex/images/webclip.png' %}" rel="apple-touch-icon">
  </head>
  <body>
    {% include 'navigation-bar.html' %}
    <div class="collection-list-wrapper-messages base-dyn-list">
      {% if messages %}
      <div role="list" class="base-dyn-items">
        {% for message in messages %}
          <div role="listitem" class="base-dyn-item">
            <div class="{% if message.tags %}{{ message.tags }}-message{% endif %}">
              <span class="text-{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</span>
            </div>
          </div>
        {% endfor %}
      </div>  
       {% endif %}  
    </div>
    <section class="section-top">
      <div class="content">
        <div class="block-top">
          <h1 class="heading-top">Taxonomy Kingdoms</h1>
          <div class="block-categories">
            <div class="collection-list-wrapper-categories base-dyn-list">
              <div role="list" class="collection-list-categories base-dyn-items">
                {% for kingdom in kingdoms %}
                  <div role="listitem" class="collection-item-categories base-dyn-item">
                    <a href="#" data-kingdom-id="{{ kingdom.id }}" class="link-category base-inline-block kingdom-link">
                      <div class="text-category">{{ kingdom.kingdom_name }}</div>
                    </a>
                  </div>
                {% endfor %}              
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    {% load static %}
    <div class="layout-grid grid-about">
      <div class="about"> 
        <div class="block-icon-about"><img src="{% static 'main/images/cloud-mod-stack.svg' %}" loading="eager" alt="" class="icon-about"></div>
        <h4 class="heading-about">Valid Taxon Units by Jurisdiction</h4>
        <p id="rank-details" class="paragraph-about">
          <!-- This is where the AJAX response will be inserted -->
        </p>
      </div>
      <div class="about red">
        <div class="block-icon-about red"><img src="{% static 'main/images/events.svg' %}" loading="eager" alt="" class="icon-about"></div>
        <h4 class="heading-about red">Valid Taxon Units by Jurisdiction</h4>
        <p id="geography-details" class="paragraph-about red">
          <!-- This is where the AJAX response will be inserted -->
        </p>
      </div>
      <div class="about blue">
        <div class="block-icon-about blue"><img src="{% static 'main/images/earth.svg' %}" loading="eager" alt="" class="icon-about"></div>
        <h4 class="heading-about blue">Valid Taxon Units by Jurisdiction</h4>
        <p id="jurisdiction-details" class="paragraph-about blue">
          <!-- This is where the AJAX response will be inserted -->
        </p>
      </div>
    </div> 
    {% include 'page-footer.html' %}
    <script>
      $(document).ready(function() {
          $('.kingdom-link').click(function(e) {
              e.preventDefault();
              const kingdomId = $(this).data('kingdom-id');

              // Construct the base URL dynamically
              const baseUrl = `${window.location.protocol}//${window.location.host}/`;

              // Construct the full URL for the AJAX request
              const requestUrl = baseUrl + `api/get-kingdom/${kingdomId}/`;

              // AJAX request to fetch kingdom details
              $.ajax({
                  url: requestUrl,
                  type: 'GET',
                  success: function(response) {
                      // Handle 'valid_units_by_rank'
                      let rankHtml = '<ul>'; // Start an unordered list
                      response.valid_units_by_rank.forEach(function(rank) {
                          // For each rank, append a list item with the rank name and valid units count
                          rankHtml += `<li>${rank.rank__rank_name}: ${rank.valid_units_count}</li>`;
                      });
                      rankHtml += '</ul>'; // Close the unordered list

                      let geographyHtml = '<ul>';
                      response.valid_units_by_geography.forEach(function(geography) {
                          geographyHtml += `<li>${geography.geography_value}: ${geography.valid_units_count}</li>`;
                      });
                      geographyHtml += '</ul>';

                      let jurisdictionHtml = '<ul>';
                      response.valid_units_by_jurisdiction.forEach(function(jurisdiction) {
                          jurisdictionHtml += `<li>${jurisdiction.jurisdiction_value}: ${jurisdiction.valid_units_count}</li>`;
                      });
                      jurisdictionHtml += '</ul>';
                            
                      $('#rank-details').html(rankHtml);
                      $('#geography-details').html(geographyHtml);
                      $('#jurisdiction-details').html(jurisdictionHtml);
                  },
                  error: function(xhr, status, error) {
                      // Handle errors here
                      console.error("Error fetching kingdom details:", error);
                  }
              });
          });
      });
    </script>         
  </body>
</html>